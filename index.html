<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon rapport √† l'IA √† l'√©cole</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* === CHARTE RETROFUTURISME === */
        :root {
            --retro-teal: #127676;
            --retro-orange: #E4632E;
            --retro-jaune: #E3A535;
            --retro-ink: #0D1617;
            --retro-paper: #F2EFE6;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: var(--retro-ink);
            min-height: 100vh;
        }

        /* Fond avec image visible */
        .app-background {
            min-height: 100vh;
            background-image: url('assets/background.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            padding: 12px;
        }

        /* Cadre Art Nouveau */
        .page-frame {
            background: rgba(242, 239, 230, 0.92);
            border: 4px solid var(--retro-orange);
            border-radius: 8px;
            position: relative;
            min-height: calc(100vh - 24px);
            padding: 60px 40px 40px;
        }

        /* Motifs floraux aux coins - sur le cadre paper uniquement */
        .corner-flourish {
            position: absolute;
            width: 50px;
            height: 50px;
            color: var(--retro-teal);
            opacity: 0.7;
            font-size: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
        }
        .corner-flourish.top-left { top: 12px; left: 16px; }
        .corner-flourish.top-right { top: 12px; right: 16px; transform: scaleX(-1); }
        .corner-flourish.bottom-left { bottom: 12px; left: 16px; transform: scaleY(-1); }
        .corner-flourish.bottom-right { bottom: 12px; right: 16px; transform: scale(-1); }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        /* Titres g√©om√©triques */
        h1, h2, h3 {
            font-family: 'Anton', Impact, sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--retro-teal);
            margin: 0;
        }

        h1 { font-size: 2rem; }
        h2 { font-size: 1.5rem; }
        h3 { font-size: 1.25rem; }

        /* Cartes retrofuturistes */
        .retro-card {
            background: var(--retro-paper);
            border: 3px solid var(--retro-teal);
            border-radius: 24px 8px 24px 8px;
            box-shadow: inset 0 0 0 2px var(--retro-orange);
            padding: 2.5rem;
            position: relative;
        }

        /* Motifs floraux aux coins des cartes */
        .retro-card .corner-flourish {
            position: absolute;
            color: var(--retro-teal);
            opacity: 0.45;
            font-size: 1.4rem;
            pointer-events: none;
        }
        .retro-card .corner-flourish.top-left { top: 8px; left: 10px; }
        .retro-card .corner-flourish.top-right { top: 8px; right: 10px; transform: scaleX(-1); }
        .retro-card .corner-flourish.bottom-left { bottom: 8px; left: 10px; transform: scaleY(-1); }
        .retro-card .corner-flourish.bottom-right { bottom: 8px; right: 10px; transform: scale(-1); }

        /* S√©parateur Art Nouveau */
        .retro-separator {
            display: flex;
            align-items: center;
            gap: 16px;
            margin: 2rem 0;
            color: var(--retro-teal);
        }

        .retro-separator::before,
        .retro-separator::after {
            content: '';
            flex: 1;
            height: 2px;
            background: linear-gradient(
                90deg,
                transparent,
                var(--retro-teal) 20%,
                var(--retro-teal) 80%,
                transparent
            );
        }

        .retro-separator .flourish {
            font-size: 1.5rem;
            opacity: 0.7;
        }

        /* Bouton Pill Retrofuturiste */
        .retro-btn-pill {
            display: inline-flex;
            align-items: stretch;
            border-radius: 50px;
            border: 3px solid var(--retro-teal);
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
            background: var(--retro-orange);
        }

        .retro-btn-pill:hover {
            transform: scale(1.03);
            box-shadow: 0 4px 12px rgba(18, 118, 118, 0.3);
        }

        .retro-btn-pill-text {
            background: var(--retro-jaune);
            color: var(--retro-ink);
            padding: 0.85rem 1.75rem;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            display: flex;
            align-items: center;
        }

        .retro-btn-pill-icon {
            background: var(--retro-orange);
            color: var(--retro-paper);
            width: 52px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        /* Bouton secondaire */
        .retro-btn-secondary {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.85rem 1.5rem;
            border: 2px solid var(--retro-teal);
            border-radius: 50px;
            background: transparent;
            color: var(--retro-teal);
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .retro-btn-secondary:hover {
            background: var(--retro-teal);
            color: var(--retro-paper);
        }

        /* Ic√¥ne ronde */
        .retro-icon-circle {
            width: 64px;
            height: 64px;
            background: var(--retro-teal);
            border: 3px solid var(--retro-orange);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin: 0 auto 1.5rem;
        }

        /* Encart info */
        .retro-info-box {
            background: rgba(18, 118, 118, 0.08);
            border-left: 4px solid var(--retro-teal);
            border-radius: 0 12px 12px 0;
            padding: 1.25rem 1.5rem;
            margin: 1.5rem 0;
        }

        .retro-info-box ul {
            list-style: none;
            padding: 0;
            margin: 0.75rem 0 0;
        }

        .retro-info-box li {
            padding: 0.4rem 0;
            color: var(--retro-ink);
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
        }

        .retro-info-box li::before {
            content: '‚óÜ';
            color: var(--retro-orange);
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }

        /* Barre de progression */
        .progress-container {
            margin-bottom: 2rem;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--retro-ink);
        }

        .progress-bar-bg {
            width: 100%;
            height: 12px;
            background: rgba(13, 22, 23, 0.15);
            border-radius: 6px;
            overflow: hidden;
            border: 2px solid var(--retro-teal);
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--retro-teal), var(--retro-orange), var(--retro-jaune));
            border-radius: 4px;
            transition: width 0.4s ease;
        }

        /* Options de r√©ponse */
        .answer-option {
            display: block;
            margin-bottom: 0.75rem;
        }

        .answer-option label {
            display: flex;
            align-items: center;
            padding: 1rem 1.25rem;
            border: 2px solid rgba(18, 118, 118, 0.4);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--retro-paper);
            color: var(--retro-ink);
        }

        .answer-option label:hover {
            border-color: var(--retro-orange);
            background: rgba(227, 165, 53, 0.1);
        }

        .answer-option input[type="radio"] {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid var(--retro-teal);
            border-radius: 50%;
            margin-right: 1rem;
            position: relative;
            flex-shrink: 0;
            cursor: pointer;
        }

        .answer-option input[type="radio"]:checked {
            border-color: var(--retro-orange);
            background: var(--retro-orange);
        }

        .answer-option input[type="radio"]:checked::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            background: var(--retro-paper);
            border-radius: 50%;
        }

        .answer-option input[type="radio"]:checked + span {
            color: var(--retro-ink);
            font-weight: 600;
        }

        /* Boutons de navigation */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 2px solid rgba(18, 118, 118, 0.2);
        }

        .nav-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-btn-prev {
            background: transparent;
            border: 2px solid var(--retro-teal);
            color: var(--retro-teal);
        }

        .nav-btn-prev:hover:not(:disabled) {
            background: var(--retro-teal);
            color: var(--retro-paper);
        }

        .nav-btn-next {
            background: var(--retro-teal);
            border: 2px solid var(--retro-teal);
            color: var(--retro-paper);
        }

        .nav-btn-next:hover:not(:disabled) {
            background: var(--retro-orange);
            border-color: var(--retro-orange);
        }

        .nav-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        /* R√©sultats */
        .results-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .results-summary-box {
            background: linear-gradient(135deg, rgba(18, 118, 118, 0.1), rgba(228, 99, 46, 0.1));
            border: 2px solid var(--retro-teal);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 2rem;
        }

        .results-summary-title {
            font-size: 1.1rem;
            color: var(--retro-teal);
            margin-bottom: 0.75rem;
        }

        .results-summary-values {
            font-family: 'Anton', Impact, sans-serif;
            font-size: 1.5rem;
            letter-spacing: 0.05em;
            color: var(--retro-ink);
        }

        /* Barres de score */
        .score-bars {
            margin-bottom: 2rem;
        }

        .score-bar-item {
            margin-bottom: 1rem;
        }

        .score-bar-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.4rem;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .score-bar-bg {
            height: 14px;
            background: rgba(13, 22, 23, 0.12);
            border-radius: 7px;
            overflow: hidden;
        }

        .score-bar-fill {
            height: 100%;
            border-radius: 7px;
            transition: width 1s ease;
        }

        .score-bar-fill.type-e { background: var(--retro-teal); }
        .score-bar-fill.type-o { background: var(--retro-orange); }
        .score-bar-fill.type-s { background: var(--retro-jaune); }

        .score-label-e { color: var(--retro-teal); }
        .score-label-o { color: var(--retro-orange); }
        .score-label-s { color: #b88a2a; }

        /* Profil description */
        .profile-box {
            background: var(--retro-paper);
            border: 2px solid var(--retro-teal);
            border-radius: 16px;
            padding: 1.5rem;
        }

        .profile-box h3 {
            margin-bottom: 0.75rem;
        }

        .profile-box p {
            color: var(--retro-ink);
            line-height: 1.6;
            margin: 0;
        }

        /* Conseils */
        .advice-box {
            background: rgba(228, 99, 46, 0.08);
            border-left: 4px solid var(--retro-orange);
            border-radius: 0 16px 16px 0;
            padding: 1.5rem;
            margin: 2rem 0;
        }

        .advice-box h3 {
            color: var(--retro-orange);
            margin-bottom: 1rem;
        }

        .advice-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }

        .advice-number {
            background: var(--retro-jaune);
            color: var(--retro-ink);
            width: 26px;
            height: 26px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            margin-right: 0.75rem;
            flex-shrink: 0;
        }

        .advice-text {
            color: var(--retro-ink);
            line-height: 1.5;
        }

        /* Action buttons */
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
        }

        /* Grid r√©sultats */
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 768px) {
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .page-frame {
                padding: 50px 20px 30px;
            }
            
            h1 { font-size: 1.5rem; }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .retro-btn-pill, .retro-btn-secondary {
                width: 100%;
                justify-content: center;
            }
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .hidden {
            display: none !important;
        }

        /* Modal r√©vision */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(13, 22, 23, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            z-index: 100;
        }

        .modal-content {
            background: var(--retro-paper);
            border: 3px solid var(--retro-teal);
            border-radius: 24px 8px 24px 8px;
            box-shadow: inset 0 0 0 2px var(--retro-orange);
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 2rem;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--retro-teal);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 2rem;
            color: var(--retro-teal);
            cursor: pointer;
            padding: 0;
            line-height: 1;
        }

        .modal-close:hover {
            color: var(--retro-orange);
        }

        .review-item {
            border: 2px solid rgba(18, 118, 118, 0.3);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .review-item h4 {
            font-family: 'Anton', Impact, sans-serif;
            color: var(--retro-teal);
            margin: 0 0 0.5rem;
            font-size: 1rem;
        }

        .review-question {
            color: var(--retro-ink);
            margin-bottom: 0.75rem;
        }

        .review-answer {
            padding: 0.75rem;
            border-radius: 8px;
        }

        .review-answer.type-e {
            background: rgba(18, 118, 118, 0.1);
            border-left: 3px solid var(--retro-teal);
        }

        .review-answer.type-o {
            background: rgba(228, 99, 46, 0.1);
            border-left: 3px solid var(--retro-orange);
        }

        .review-answer.type-s {
            background: rgba(227, 165, 53, 0.15);
            border-left: 3px solid var(--retro-jaune);
        }

        .review-answer .badge {
            display: inline-block;
            padding: 0.2rem 0.6rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        .badge.type-e { background: var(--retro-teal); color: var(--retro-paper); }
        .badge.type-o { background: var(--retro-orange); color: var(--retro-paper); }
        .badge.type-s { background: var(--retro-jaune); color: var(--retro-ink); }

        /* Question text */
        .question-text {
            font-size: 1.15rem;
            font-weight: 500;
            color: var(--retro-ink);
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="app-background">
        <div class="page-frame">
            <div class="container">
                <!-- √âcran d'accueil -->
                <div id="welcome-screen" class="fade-in">
                    <div class="retro-card">
                        <span class="corner-flourish top-left">‚ùß</span>
                        <span class="corner-flourish top-right">‚ùß</span>
                        <span class="corner-flourish bottom-left">‚ùß</span>
                        <span class="corner-flourish bottom-right">‚ùß</span>
                        <div style="text-align: center;">
                            <div class="retro-icon-circle">ü§ñ</div>
                            <h1>Mon rapport √† l'IA √† l'√©cole</h1>
                            <p style="color: var(--retro-ink); font-size: 1.1rem; margin-top: 1rem;">
                                D√©couvre ta posture face √† l'intelligence artificielle
                            </p>
                        </div>

                        <div class="retro-separator">
                            <span class="flourish">‚úø</span>
                        </div>

                        <div class="retro-info-box">
                            <h3 style="margin: 0; font-size: 1rem;">√Ä PROPOS DE CE QUESTIONNAIRE</h3>
                            <ul>
                                <li><strong>Anonyme</strong> : Tes r√©ponses restent priv√©es</li>
                                <li><strong>Sans jugement</strong> : Il n'y a pas de bonnes ou mauvaises r√©ponses</li>
                                <li><strong>20 questions</strong> : Environ 8 minutes de ton temps</li>
                                <li><strong>R√©sultat personnalis√©</strong> : Tu recevras des conseils adapt√©s</li>
                            </ul>
                        </div>

                        <div style="text-align: center; margin-top: 2rem;">
                            <button onclick="startQuiz()" class="retro-btn-pill">
                                <span class="retro-btn-pill-text">Commencer le questionnaire</span>
                                <span class="retro-btn-pill-icon">¬ª</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- √âcran des questions -->
                <div id="question-screen" class="hidden fade-in">
                    <div class="retro-card">
                        <span class="corner-flourish top-left">‚ùß</span>
                        <span class="corner-flourish top-right">‚ùß</span>
                        <span class="corner-flourish bottom-left">‚ùß</span>
                        <span class="corner-flourish bottom-right">‚ùß</span>
                        <!-- Barre de progression -->
                        <div class="progress-container">
                            <div class="progress-info">
                                <span>Question <span id="current-question">1</span> sur 20</span>
                                <span><span id="progress-percent">5</span>%</span>
                            </div>
                            <div class="progress-bar-bg">
                                <div id="progress-bar" class="progress-bar-fill" style="width: 5%"></div>
                            </div>
                        </div>

                        <!-- Question -->
                        <div class="question-text" id="question-text"></div>
                        
                        <div id="answers-container">
                            <!-- Les r√©ponses seront g√©n√©r√©es ici -->
                        </div>

                        <!-- Boutons de navigation -->
                        <div class="nav-buttons">
                            <button id="prev-btn" onclick="previousQuestion()" class="nav-btn nav-btn-prev" disabled>
                                ‚Üê Pr√©c√©dent
                            </button>
                            <button id="next-btn" onclick="nextQuestion()" class="nav-btn nav-btn-next" disabled>
                                Suivant ‚Üí
                            </button>
                        </div>
                    </div>
                </div>

                <!-- √âcran des r√©sultats -->
                <div id="results-screen" class="hidden fade-in">
                    <div class="retro-card">
                        <span class="corner-flourish top-left">‚ùß</span>
                        <span class="corner-flourish top-right">‚ùß</span>
                        <span class="corner-flourish bottom-left">‚ùß</span>
                        <span class="corner-flourish bottom-right">‚ùß</span>
                        <div class="results-header">
                            <div class="retro-icon-circle">‚ú®</div>
                            <h1>Ton rapport personnel</h1>
                            <p style="color: var(--retro-ink); margin-top: 0.75rem;">Voici ton profil face √† l'IA √† l'√©cole</p>
                        </div>

                        <!-- Bloc R√©sultats -->
                        <div class="results-summary-box">
                            <div class="results-summary-title">R√âSULTATS</div>
                            <div class="results-summary-values" id="results-summary">
                                <!-- E = X% | O = Y% | S = Z% sera g√©n√©r√© ici -->
                            </div>
                        </div>

                        <div class="retro-separator">
                            <span class="flourish">‚ùÄ</span>
                        </div>

                        <!-- Graphique des r√©sultats -->
                        <div class="results-grid">
                            <div>
                                <h3 style="margin-bottom: 1rem;">R√âPARTITION DE TES R√âPONSES</h3>
                                <div class="score-bars">
                                    <div class="score-bar-item">
                                        <div class="score-bar-header">
                                            <span class="score-label-e">Engag√© r√©flexif</span>
                                            <span id="score-e-percent" class="score-label-e">0%</span>
                                        </div>
                                        <div class="score-bar-bg">
                                            <div id="bar-e" class="score-bar-fill type-e" style="width: 0%"></div>
                                        </div>
                                    </div>
                                    <div class="score-bar-item">
                                        <div class="score-bar-header">
                                            <span class="score-label-o">Occasionnel l√©galiste</span>
                                            <span id="score-o-percent" class="score-label-o">0%</span>
                                        </div>
                                        <div class="score-bar-bg">
                                            <div id="bar-o" class="score-bar-fill type-o" style="width: 0%"></div>
                                        </div>
                                    </div>
                                    <div class="score-bar-item">
                                        <div class="score-bar-header">
                                            <span class="score-label-s">Scolaire opportuniste</span>
                                            <span id="score-s-percent" class="score-label-s">0%</span>
                                        </div>
                                        <div class="score-bar-bg">
                                            <div id="bar-s" class="score-bar-fill type-s" style="width: 0%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="profile-description" class="profile-box">
                                <!-- Description du profil sera g√©n√©r√©e ici -->
                            </div>
                        </div>

                        <!-- Conseils personnalis√©s -->
                        <div id="advice-section" class="advice-box">
                            <!-- Conseils seront g√©n√©r√©s ici -->
                        </div>

                        <!-- Boutons d'action -->
                        <div class="action-buttons">
                            <button onclick="reviewAnswers()" class="retro-btn-secondary">
                                üëÅÔ∏è Revoir mes r√©ponses
                            </button>
                            <button onclick="downloadPDF()" class="retro-btn-pill">
                                <span class="retro-btn-pill-text">üìÑ T√©l√©charger mon rapport</span>
                                <span class="retro-btn-pill-icon">‚Üì</span>
                            </button>
                            <button onclick="restartQuiz()" class="retro-btn-secondary">
                                üîÑ Recommencer
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Questions et r√©ponses
        const questions = [
            {
                text: "Quand tu utilises une IA, ton but principal est‚Ä¶",
                answers: [
                    { text: "Obtenir une aide ponctuelle sans tricher.", type: "O" },
                    { text: "Trouver des id√©es/structure puis retravailler √† ta fa√ßon.", type: "E" },
                    { text: "Gagner du temps sur un devoir.", type: "S" }
                ]
            },
            {
                text: "Si l'IA te donne une r√©ponse fausse ou floue, tu‚Ä¶",
                answers: [
                    { text: "Reformules ton prompt.", type: "E" },
                    { text: "Compares avec ton cours.", type: "O" },
                    { text: "Copies ce qui te parait correct", type: "S" }
                ]
            },
            {
                text: "Pour toi, utiliser l'IA pour un devoir, c'est surtout‚Ä¶",
                answers: [
                    { text: "Un moyen d'aller plus vite.", type: "S" },
                    { text: "Une fa√ßon d'apprendre autrement.", type: "E" },
                    { text: "Un petit coup de pouce discret.", type: "O" }
                ]
            },
            {
                text: "Quand tu poses une question √† l'IA, tu‚Ä¶",
                answers: [
                    { text: "Fais attention √† ne pas trop l'utiliser.", type: "O" },
                    { text: "Reformules jusqu'√† une r√©ponse claire.", type: "E" },
                    { text: "Prends la premi√®re r√©ponse correcte.", type: "S" }
                ]
            },
            {
                text: "Si un prof encourage l'IA, tu penses que‚Ä¶",
                answers: [
                    { text: "Super, je gagnerai du temps.", type: "S" },
                    { text: "C'est une occasion de mieux comprendre.", type: "E" },
                    { text: "C'est OK si tu sais exactement ce qui est autoris√©.", type: "O" }
                ]
            },
            {
                text: "Quand tu rends un travail aid√© par l'IA, tu‚Ä¶",
                answers: [
                    { text: "Te demandes si tu dois le dire ou pas.", type: "O" },
                    { text: "Ne dis rien et camoufles.", type: "S" },
                    { text: "Indiques comment tu l'as utilis√©e.", type: "E" }
                ]
            },
            {
                text: "Pour comprendre une notion difficile, tu utilises l'IA pour‚Ä¶",
                answers: [
                    { text: "Avoir une explication rapide puis tu relis ton cours pour v√©rifier.", type: "O" },
                    { text: "Obtenir des explications que tu peux approfondir en posant de nombreuses questions.", type: "E" },
                    { text: "Demander une r√©ponse √† copier.", type: "S" }
                ]
            },
            {
                text: "Si un camarade t'envoie une r√©daction faite par IA‚Ä¶",
                answers: [
                    { text: "Tu regardes mais tu r√©diges la tienne.", type: "O" },
                    { text: "Tu cherches √† savoir comment tu pourrais l'am√©liorer", type: "E" },
                    { text: "Tu changes quelques phrases et rends.", type: "S" }
                ]
            },
            {
                text: "L'IA peut aider √† apprendre ?",
                answers: [
                    { text: "Oui, √ßa remplace parfois les cours.", type: "S" },
                    { text: "Oui, si on r√©fl√©chit et reformule.", type: "E" },
                    { text: "Oui, mais attention √† la triche.", type: "O" }
                ]
            },
            {
                text: "Quand tu travailles avec l'IA, tu ressens‚Ä¶",
                answers: [
                    { text: "M√©fiance (peur de mal faire).", type: "O" },
                    { text: "Satisfaction quand √ßa travaille √† ma place.", type: "S" },
                    { text: "Curiosit√© et envie de tester.", type: "E" },
                ]
            },
            {
                text: "Si l'IA est interdite, tu‚Ä¶",
                answers: [
                    { text: "L'utilises discr√®tement.", type: "S" },
                    { text: "Respectes et aimerais en discuter avec l'enseignant.", type: "E" },
                    { text: "Respectes sans r√©fl√©chir.", type: "O" }
                ]
            },
            {
                text: "Quand tu utilises l'IA, tu fais attention √†‚Ä¶",
                answers: [
                    { text: "Ce qui est autoris√©.", type: "O" },
                    { text: "La qualit√© des sources/v√©racit√©.", type: "E" },
                    { text: "Finir vite.", type: "S" }
                ]
            },
            {
                text: "Quelle phrase te ressemble le plus ?",
                answers: [
                    { text: "L'IA est pratique pour aller vite.", type: "S" },
                    { text: "L'IA approfondit mes apprentissages.", type: "E" },
                    { text: "L'IA m'aide mais j'ai un peu l'impression de tricher", type: "O" }
                ]
            },
            {
                text: "Avant de rendre un texte g√©n√©r√© par IA, tu‚Ä¶",
                answers: [
                    { text: "Veux √™tre s√ªr d'avoir bien compris les consignes concernant l'utilisation de l'IA", type: "O" },
                    { text: "V√©rifie la justesse des infomations, reformule tout ce que tu as envie de reformuler", type: "E" },
                    { text: "Changes un peu pour que √ßa se voie moins.", type: "S" }
                ]
            },
            {
                text: "Si l'IA se trompe, c'est parce que‚Ä¶",
                answers: [
                    { text: "Je n'aurais pas d√ª utiliser l'IA.", type: "O" },
                    { text: "Ma question √©tait mal formul√©e.", type: "E" },
                    { text: "Ce n'est pas grave.", type: "S" }
                ]
            },
            {
                text: "Le r√¥le de l'IA √† l'√©cole devrait √™tre‚Ä¶",
                answers: [
                    { text: "Un assistant pour gagner du temps.", type: "S" },
                    { text: "Un outil d'apprentissage critique.", type: "E" },
                    { text: "Un soutien avec r√®gles claires.", type: "O" }
                ]
            },
            {
                text: "Tu fais confiance √† l'IA quand elle explique ?",
                answers: [
                    { text: "Oui, sauf si c'est contraire √† ce qu'√† dit l'enseignant.", type: "O" },
                    { text: "Je v√©rifie toujours ailleurs.", type: "E" },
                    { text: "Oui, je ne perd pas de temps √† v√©rifier.", type: "S" }
                ]
            },
            {
                text: "Quand un prof parle d'IA, tu‚Ä¶",
                answers: [
                    { text: "√âcoutes sans avis.", type: "O" },
                    { text: "Participes et poses des questions.", type: "E" },
                    { text: "T'ennuies, c'est √©vident.", type: "S" }
                ]
            },
            {
                text: "Si tu pouvais cr√©er un outil IA, il‚Ä¶",
                answers: [
                    { text: "Donnerait des r√©ponses fiables vite.", type: "S" },
                    { text: "Aiderait √† apprendre par explications adapt√©es.", type: "E" },
                    { text: "Serait autoris√© partout.", type: "O" }
                ]
            },
            {
                text: "Apprendre √† bien utiliser l'IA √† l'√©cole, c'est‚Ä¶",
                answers: [
                    { text: "Utile mais pas prioritaire.", type: "O" },
                    { text: "Indispensable pour le futur.", type: "E" },
                    { text: "Utile pour aller √† l'essentiel", type: "S" }
                ]
            }
        ];

        // Variables globales
        let currentQuestionIndex = 0;
        let answers = [];
        let scores = { E: 0, O: 0, S: 0 };
        let lastPercentages = { E: 0, O: 0, S: 0 };
        let lastProfileDetails = { title: '', description: '' };

        const dom = {
            welcomeScreen: document.getElementById('welcome-screen'),
            questionScreen: document.getElementById('question-screen'),
            resultsScreen: document.getElementById('results-screen'),
            questionText: document.getElementById('question-text'),
            currentQuestion: document.getElementById('current-question'),
            progressPercent: document.getElementById('progress-percent'),
            progressBar: document.getElementById('progress-bar'),
            answersContainer: document.getElementById('answers-container'),
            prevBtn: document.getElementById('prev-btn'),
            nextBtn: document.getElementById('next-btn'),
            scoreEPercent: document.getElementById('score-e-percent'),
            scoreOPercent: document.getElementById('score-o-percent'),
            scoreSPercent: document.getElementById('score-s-percent'),
            barE: document.getElementById('bar-e'),
            barO: document.getElementById('bar-o'),
            barS: document.getElementById('bar-s'),
            resultsSummary: document.getElementById('results-summary'),
            profileDescription: document.getElementById('profile-description'),
            adviceSection: document.getElementById('advice-section')
        };

        // D√©marrer le questionnaire
        function startQuiz() {
            dom.welcomeScreen.classList.add('hidden');
            dom.questionScreen.classList.remove('hidden');
            showQuestion();
        }

        // Afficher une question
        function showQuestion() {
            const question = questions[currentQuestionIndex];
            dom.questionText.textContent = question.text;
            dom.currentQuestion.textContent = currentQuestionIndex + 1;
            const progressRatio = (currentQuestionIndex + 1) / questions.length;
            dom.progressPercent.textContent = Math.round(progressRatio * 100);
            dom.progressBar.style.width = `${progressRatio * 100}%`;

            const container = dom.answersContainer;
            container.innerHTML = '';

            const fragment = document.createDocumentFragment();

            question.answers.forEach((answer, index) => {
                const wrapper = document.createElement('div');
                wrapper.className = 'answer-option';
                
                const label = document.createElement('label');

                const input = document.createElement('input');
                input.type = 'radio';
                input.name = 'answer';
                input.value = String(index);
                input.addEventListener('change', updateNextButton);

                const textSpan = document.createElement('span');
                textSpan.textContent = answer.text;

                label.appendChild(input);
                label.appendChild(textSpan);
                wrapper.appendChild(label);
                fragment.appendChild(wrapper);
            });

            container.appendChild(fragment);

            // Restaurer la r√©ponse pr√©c√©dente si elle existe
            if (answers[currentQuestionIndex] !== undefined) {
                const radio = container.querySelector(`input[name="answer"][value="${answers[currentQuestionIndex]}"]`);
                if (radio) radio.checked = true;
            }

            // Mettre √† jour les boutons
            dom.prevBtn.disabled = currentQuestionIndex === 0;
            updateNextButton();
        }

        // Mettre √† jour le bouton suivant
        function updateNextButton() {
            const selected = dom.answersContainer.querySelector('input[name="answer"]:checked');
            dom.nextBtn.disabled = !selected;
        }

        // Question suivante
        function nextQuestion() {
            const selected = dom.answersContainer.querySelector('input[name="answer"]:checked');
            if (!selected) return;

            answers[currentQuestionIndex] = parseInt(selected.value, 10);

            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
            } else {
                calculateResults();
                showResults();
            }
        }

        // Question pr√©c√©dente
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
            }
        }

        // Calculer les r√©sultats
        function calculateResults() {
            scores = { E: 0, O: 0, S: 0 };

            answers.forEach((answerIndex, questionIndex) => {
                if (typeof answerIndex !== 'number') {
                    return;
                }

                const selectedAnswer = questions[questionIndex].answers[answerIndex];
                if (!selectedAnswer) {
                    return;
                }

                const answerType = selectedAnswer.type;
                if (scores[answerType] !== undefined) {
                    scores[answerType]++;
                }
            });
        }

        // Afficher les r√©sultats
        function showResults() {
            dom.questionScreen.classList.add('hidden');
            dom.resultsScreen.classList.remove('hidden');

            const totalNonNeutral = scores.E + scores.O + scores.S;

            if (totalNonNeutral === 0) {
                lastPercentages = { E: 0, O: 0, S: 0 };
                dom.scoreEPercent.textContent = '0%';
                dom.scoreOPercent.textContent = '0%';
                dom.scoreSPercent.textContent = '0%';
                dom.barE.style.width = '0%';
                dom.barO.style.width = '0%';
                dom.barS.style.width = '0%';
                dom.resultsSummary.textContent = 'E = 0% | O = 0% | S = 0%';
                showIndeterminateProfile();
                return;
            }

            const percentages = {
                E: Math.round((scores.E / totalNonNeutral) * 100),
                O: Math.round((scores.O / totalNonNeutral) * 100),
                S: Math.round((scores.S / totalNonNeutral) * 100)
            };

            lastPercentages = percentages;

            // Afficher les pourcentages et barres
            setTimeout(() => {
                dom.scoreEPercent.textContent = `${percentages.E}%`;
                dom.scoreOPercent.textContent = `${percentages.O}%`;
                dom.scoreSPercent.textContent = `${percentages.S}%`;

                dom.barE.style.width = `${percentages.E}%`;
                dom.barO.style.width = `${percentages.O}%`;
                dom.barS.style.width = `${percentages.S}%`;

                // Mettre √† jour le r√©sum√© des r√©sultats
                dom.resultsSummary.textContent = `E = ${percentages.E}% | O = ${percentages.O}% | S = ${percentages.S}%`;
            }, 500);

            // D√©terminer le profil selon les nouvelles r√®gles
            determineProfile(percentages);
        }

        // D√©terminer le profil selon les crit√®res sp√©cifi√©s
        function determineProfile(percentages) {
            const maxScore = Math.max(percentages.E, percentages.O, percentages.S);
            const dominantTypes = [];
            
            // Identifier les types dominants
            if (percentages.E === maxScore) dominantTypes.push('E');
            if (percentages.O === maxScore) dominantTypes.push('O');
            if (percentages.S === maxScore) dominantTypes.push('S');

            // V√©rifier si une posture est ‚â• 40% et strictement dominante
            let isDominant = false;
            let dominantType = null;

            if (dominantTypes.length === 1 && maxScore >= 40) {
                // V√©rifier que l'√©cart avec les autres est > 10 points
                const otherScores = Object.values(percentages).filter(score => score !== maxScore);
                const maxOtherScore = Math.max(...otherScores);
                
                if (maxScore - maxOtherScore >= 10) {
                    isDominant = true;
                    dominantType = dominantTypes[0];
                }
            }

            if (isDominant) {
                showDominantProfile(dominantType, percentages);
            } else {
                showMixedProfile(percentages);
            }
        }

        // Profil dominant
        function showDominantProfile(profile, percentages) {
            const profiles = {
                E: {
                    title: "Engag√© r√©flexif",
                    description: "Tu utilises l'IA pour apprendre : reformulation, v√©rification, curiosit√©. Continue √† demander pourquoi et √† comparer aux cours.",
                    colorClass: "score-label-e"
                },
                O: {
                    title: "Occasionnel l√©galiste",
                    description: "Tu es prudent et respectes les r√®gles. Pour progresser : ose reformuler, demande des explications pas √† pas, compare plusieurs sources, explicite comment tu utilises l'IA.",
                    colorClass: "score-label-o"
                },
                S: {
                    title: "Scolaire opportuniste",
                    description: "Tu utilises l'IA surtout pour aller vite. Pour progresser : relis et r√©√©cris avec tes mots, demande √† l'IA d'expliquer comment elle a construit sa r√©ponse, v√©rifie avec le cours, cr√©e ta version am√©lior√©e.",
                    colorClass: "score-label-s"
                }
            };

            const profileData = profiles[profile];
            dom.profileDescription.innerHTML = `
                <h3 class="${profileData.colorClass}">Ta posture actuelle : ${profileData.title}</h3>
                <p>${profileData.description}</p>
            `;

            lastProfileDetails = {
                title: `Ta posture actuelle : ${profileData.title}`,
                description: profileData.description
            };

            showAdviceSection();
        }

        // Profil mixte
        function showMixedProfile(percentages) {
            dom.profileDescription.innerHTML = `
                <h3 style="color: var(--retro-orange);">Profil mixte</h3>
                <p>Tu combines plusieurs postures. Choisis une habitude "r√©flexive" √† tester cette semaine (reformuler, v√©rifier les sources, expliquer pourquoi).</p>
            `;

            lastProfileDetails = {
                title: 'Profil mixte',
                description: 'Tu combines plusieurs postures. Choisis une habitude "r√©flexive" √† tester cette semaine (reformuler, v√©rifier les sources, expliquer pourquoi).'
            };

            showAdviceSection();
        }

        // Conseils vers l'engag√© r√©flexif (toujours afficher)
        function showAdviceSection() {
            dom.adviceSection.innerHTML = `
                <h3>CONSEILS "VERS L'ENGAG√â R√âFLEXIF"</h3>
                <div class="advice-item">
                    <span class="advice-number">1</span>
                    <span class="advice-text">Reformule tes questions et r√©ponses.</span>
                </div>
                <div class="advice-item">
                    <span class="advice-number">2</span>
                    <span class="advice-text">V√©rifie avec tes notes ou d'autres sources.</span>
                </div>
                <div class="advice-item">
                    <span class="advice-number">3</span>
                    <span class="advice-text">Explique le raisonnement demand√© (pas seulement la r√©ponse).</span>
                </div>
                <div class="advice-item">
                    <span class="advice-number">4</span>
                    <span class="advice-text">Personnalise le texte (exemples, vocabulaire √† toi).</span>
                </div>
                <div class="advice-item">
                    <span class="advice-number">5</span>
                    <span class="advice-text">Rends transparent l'usage de l'IA (dire comment et pourquoi).</span>
                </div>
            `;
        }

        // Profil ind√©termin√©
        function showIndeterminateProfile() {
            dom.profileDescription.innerHTML = `
                <h3>Profil ind√©termin√©</h3>
                <p>Tes r√©ponses ne permettent pas de d√©finir une posture claire face √† l'IA. Tu es peut-√™tre encore en phase de d√©couverte.</p>
            `;

            dom.adviceSection.innerHTML = `
                <h3>CONSEILS POUR COMMENCER</h3>
                <p style="color: var(--retro-ink);">Prends le temps d'exp√©rimenter avec l'IA dans un cadre scolaire. Commence par de petites questions et observe comment elle peut t'aider √† apprendre.</p>
            `;

            lastProfileDetails = {
                title: 'Profil ind√©termin√©',
                description: 'Tes r√©ponses ne permettent pas de d√©finir une posture claire face √† l\'IA. Tu es peut-√™tre encore en phase de d√©couverte.'
            };
        }

        // T√©l√©charger le PDF
        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Couleurs retrofuturistes
            const teal = [18, 118, 118];
            const orange = [228, 99, 46];
            const ink = [13, 22, 23];
            
            // Cadre d√©coratif
            doc.setDrawColor(...orange);
            doc.setLineWidth(2);
            doc.rect(10, 10, 190, 277);
            
            // Titre principal
            doc.setFontSize(20);
            doc.setTextColor(...teal);
            doc.text('TON RAPPORT PERSONNEL', 105, 30, { align: 'center' });
            doc.setFontSize(14);
            doc.text('MON RAPPORT √Ä L\'IA', 105, 40, { align: 'center' });
            
            // Ligne d√©corative
            doc.setDrawColor(...teal);
            doc.setLineWidth(0.5);
            doc.line(40, 48, 170, 48);
            
            // Bloc R√©sultats
            doc.setFontSize(14);
            doc.setTextColor(...orange);
            doc.text('R√âSULTATS', 20, 65);
            
            const totalNonNeutral = scores.E + scores.O + scores.S;
            if (totalNonNeutral > 0) {
                doc.setFontSize(12);
                doc.setTextColor(...ink);
                doc.text(`E = ${lastPercentages.E}% | O = ${lastPercentages.O}% | S = ${lastPercentages.S}%`, 20, 78);

                // D√©tails des pourcentages
                doc.setFontSize(11);
                doc.text(`‚óÜ Engag√© r√©flexif (E) : ${lastPercentages.E}%`, 25, 92);
                doc.text(`‚óÜ Occasionnel l√©galiste (O) : ${lastPercentages.O}%`, 25, 102);
                doc.text(`‚óÜ Scolaire opportuniste (S) : ${lastPercentages.S}%`, 25, 112);
            } else {
                doc.setFontSize(12);
                doc.setTextColor(...ink);
                doc.text('Aucun r√©sultat disponible.', 20, 78);
            }

            // Interpr√©tation du profil
            doc.setFontSize(14);
            doc.setTextColor(...teal);
            doc.text('INTERPR√âTATION', 20, 135);
            
            doc.setFontSize(11);
            doc.setTextColor(...ink);
            const profileText = `${lastProfileDetails.title}\n${lastProfileDetails.description}`;
            const splitProfile = doc.splitTextToSize(profileText, 170);
            doc.text(splitProfile, 20, 148);
            
            // Conseils vers l'engag√© r√©flexif
            doc.setFontSize(14);
            doc.setTextColor(...orange);
            doc.text('CONSEILS "VERS L\'ENGAG√â R√âFLEXIF"', 20, 190);
            
            doc.setFontSize(10);
            doc.setTextColor(...ink);
            
            const adviceList = [
                '1. Reformule tes questions et r√©ponses.',
                '2. V√©rifie avec tes notes ou d\'autres sources.',
                '3. Explique le raisonnement demand√© (pas seulement la r√©ponse).',
                '4. Personnalise le texte (exemples, vocabulaire √† toi).',
                '5. Rends transparent l\'usage de l\'IA (dire comment et pourquoi).'
            ];
            
            let yPosition = 203;
            adviceList.forEach(advice => {
                doc.text(advice, 25, yPosition);
                yPosition += 10;
            });
            
            // Note de confidentialit√©
            doc.setFontSize(8);
            doc.setTextColor(100, 100, 100);
            doc.text('Ce rapport est personnel et confidentiel. Aucune donn√©e nominative n\'est collect√©e.', 105, 275, { align: 'center' });
            
            doc.save('mon-rapport-ia-ecole.pdf');
        }

        // Revoir les r√©ponses
        function reviewAnswers() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';

            const dialog = document.createElement('div');
            dialog.className = 'modal-content';

            const header = document.createElement('div');
            header.className = 'modal-header';

            const title = document.createElement('h2');
            title.textContent = 'R√âVISION DE TES R√âPONSES';

            const closeIconButton = document.createElement('button');
            closeIconButton.type = 'button';
            closeIconButton.className = 'modal-close';
            closeIconButton.setAttribute('aria-label', 'Fermer');
            closeIconButton.innerHTML = '√ó';
            closeIconButton.addEventListener('click', closeReviewModal);

            header.appendChild(title);
            header.appendChild(closeIconButton);

            const contentWrapper = document.createElement('div');

            questions.forEach((question, index) => {
                const userAnswerIndex = answers[index];
                const userAnswer = typeof userAnswerIndex === 'number' ? question.answers[userAnswerIndex] : undefined;

                const questionBlock = document.createElement('div');
                questionBlock.className = 'review-item';

                const questionTitle = document.createElement('h4');
                questionTitle.textContent = `QUESTION ${index + 1}`;

                const questionText = document.createElement('p');
                questionText.className = 'review-question';
                questionText.textContent = question.text;

                const answerContainer = document.createElement('div');

                if (userAnswer) {
                    let typeClass = 'type-e';
                    let typeName = 'Engag√© r√©flexif';

                    if (userAnswer.type === 'O') {
                        typeClass = 'type-o';
                        typeName = 'Occasionnel l√©galiste';
                    } else if (userAnswer.type === 'S') {
                        typeClass = 'type-s';
                        typeName = 'Scolaire opportuniste';
                    }

                    answerContainer.className = `review-answer ${typeClass}`;

                    const answerLabel = document.createElement('p');
                    answerLabel.innerHTML = '<strong>Ta r√©ponse :</strong>';

                    const answerText = document.createElement('p');
                    answerText.textContent = userAnswer.text;

                    const badge = document.createElement('span');
                    badge.className = `badge ${typeClass}`;
                    badge.textContent = typeName;

                    answerContainer.appendChild(answerLabel);
                    answerContainer.appendChild(answerText);
                    answerContainer.appendChild(badge);
                } else {
                    answerContainer.className = 'review-answer';
                    answerContainer.style.background = 'rgba(13, 22, 23, 0.05)';
                    answerContainer.style.borderLeftColor = 'var(--retro-ink)';

                    const noAnswer = document.createElement('p');
                    noAnswer.textContent = 'Tu n\'as pas r√©pondu √† cette question.';

                    answerContainer.appendChild(noAnswer);
                }

                questionBlock.appendChild(questionTitle);
                questionBlock.appendChild(questionText);
                questionBlock.appendChild(answerContainer);

                contentWrapper.appendChild(questionBlock);
            });

            const footer = document.createElement('div');
            footer.style.cssText = 'margin-top: 1.5rem; text-align: center;';

            const closeButton = document.createElement('button');
            closeButton.type = 'button';
            closeButton.className = 'retro-btn-secondary';
            closeButton.textContent = 'Fermer';
            closeButton.addEventListener('click', closeReviewModal);

            footer.appendChild(closeButton);

            dialog.appendChild(header);
            dialog.appendChild(contentWrapper);
            dialog.appendChild(footer);

            modal.appendChild(dialog);

            document.body.appendChild(modal);
        }

        // Fermer la modal de r√©vision
        function closeReviewModal() {
            const modal = document.querySelector('.modal-overlay');
            if (modal) {
                document.body.removeChild(modal);
            }
        }

        // Recommencer
        function restartQuiz() {
            currentQuestionIndex = 0;
            answers = [];
            scores = { E: 0, O: 0, S: 0 };
            lastPercentages = { E: 0, O: 0, S: 0 };
            lastProfileDetails = { title: '', description: '' };

            dom.resultsScreen.classList.add('hidden');
            dom.questionScreen.classList.add('hidden');
            dom.welcomeScreen.classList.remove('hidden');
        }
    </script>
</body>
</html>

