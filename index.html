<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon rapport √† l'IA √† l'√©cole</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        .app-background {
            min-height: 100vh;
            background-color: #f0f4ff;
            background-image: url('assets/background.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .progress-bar {
            transition: width 0.3s ease;
        }
        
        /* Th√®me clair uniquement - contraste optimal */
        
        /* Fonds clairs - texte noir pour un contraste parfait */
        .bg-white,
        .bg-gray-50,
        .bg-blue-50,
        .bg-green-50,
        .bg-orange-50,
        .bg-purple-50,
        .bg-indigo-50 {
            color: #1f2937 !important;
        }
        
        .bg-white .text-gray-800,
        .bg-white .text-gray-700,
        .bg-white .text-gray-600,
        .bg-gray-50 .text-gray-800,
        .bg-gray-50 .text-gray-700,
        .bg-gray-50 .text-gray-600,
        .bg-blue-50 .text-blue-800,
        .bg-blue-50 .text-blue-700,
        .bg-green-50 .text-green-800,
        .bg-green-50 .text-green-700,
        .bg-orange-50 .text-orange-800,
        .bg-orange-50 .text-orange-700,
        .bg-purple-50 .text-purple-800,
        .bg-indigo-50 .text-indigo-800 {
            color: #1f2937 !important;
        }
        
        /* Fonds fonc√©s (gradients) - texte blanc */
        .bg-gradient-to-r {
            color: #f8fafc !important;
        }
    </style>
</head>
<body class="app-background font-sans">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- √âcran d'accueil -->
        <div id="welcome-screen" class="fade-in">
            <div class="bg-white rounded-xl shadow-lg p-8 text-center">
                <div class="mb-6">
                    <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center">
                        <span class="text-white text-2xl">ü§ñ</span>
                    </div>
                    <h1 class="text-3xl font-bold text-gray-800 mb-4">Mon rapport √† l'IA √† l'√©cole</h1>
                    <p class="text-lg text-gray-600 mb-6">D√©couvre ta posture face √† l'intelligence artificielle</p>
                </div>
                
                <div class="bg-blue-50 rounded-lg p-6 mb-8 text-left">
                    <h2 class="font-semibold text-blue-800 mb-3">√Ä propos de ce questionnaire :</h2>
                    <ul class="text-blue-800 space-y-2">
                        <li>‚Ä¢ <strong>Anonyme</strong> : Tes r√©ponses restent priv√©es</li>
                        <li>‚Ä¢ <strong>Sans jugement</strong> : Il n'y a pas de bonnes ou mauvaises r√©ponses</li>
                        <li>‚Ä¢ <strong>20 questions</strong> : Environ 8 minutes de ton temps</li>
                        <li>‚Ä¢ <strong>R√©sultat personnalis√©</strong> : Tu recevras des conseils adapt√©s</li>
                    </ul>
                </div>
                
                <button onclick="startQuiz()" class="bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-8 py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-indigo-700 transition-all duration-200 transform hover:scale-105">
                    Commencer le questionnaire
                </button>
            </div>
        </div>

        <!-- √âcran des questions -->
        <div id="question-screen" class="hidden fade-in">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <!-- Barre de progression -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm font-medium text-gray-700">Question <span id="current-question">1</span> sur 20</span>
                        <span class="text-sm font-medium text-gray-700"><span id="progress-percent">5</span>%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="progress-bar" class="bg-gradient-to-r from-blue-500 to-indigo-600 h-2 rounded-full progress-bar" style="width: 5%"></div>
                    </div>
                </div>

                <!-- Question -->
                <div class="mb-8">
                    <h2 id="question-text" class="text-xl font-semibold text-gray-800 mb-6"></h2>
                    <div id="answers-container" class="space-y-3">
                        <!-- Les r√©ponses seront g√©n√©r√©es ici -->
                    </div>
                </div>

                <!-- Boutons de navigation -->
                <div class="flex justify-between">
                    <button id="prev-btn" onclick="previousQuestion()" class="px-6 py-2 border border-gray-400 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        Pr√©c√©dent
                    </button>
                    <button id="next-btn" onclick="nextQuestion()" class="px-6 py-2 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        Suivant
                    </button>
                </div>
            </div>
        </div>

        <!-- √âcran des r√©sultats -->
        <div id="results-screen" class="hidden fade-in">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <div class="text-center mb-8">
                    <div class="w-20 h-20 bg-gradient-to-r from-green-500 to-blue-600 rounded-full mx-auto mb-4 flex items-center justify-center">
                        <span class="text-white text-3xl">‚ú®</span>
                    </div>
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">Ton rapport personnel ‚Äî Mon rapport √† l'IA</h1>
                    <p class="text-gray-800">Voici ton profil face √† l'IA √† l'√©cole</p>
                </div>

                <!-- Bloc R√©sultats -->
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 mb-8 text-center">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">R√©sultats</h2>
                    <div class="text-2xl font-bold text-gray-800" id="results-summary">
                        <!-- E = X% | O = Y% | S = Z% sera g√©n√©r√© ici -->
                    </div>
                </div>

                <!-- Graphique des r√©sultats -->
                <div class="grid md:grid-cols-2 gap-8 mb-8">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">R√©partition de tes r√©ponses</h3>
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between items-center mb-1">
                                    <span class="text-sm font-medium text-green-800">Engag√© r√©flexif</span>
                                    <span id="score-e-percent" class="text-sm font-bold text-green-800">0%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-3">
                                    <div id="bar-e" class="bg-green-500 h-3 rounded-full transition-all duration-1000" style="width: 0%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between items-center mb-1">
                                    <span class="text-sm font-medium text-blue-800">Occasionnel l√©galiste</span>
                                    <span id="score-o-percent" class="text-sm font-bold text-blue-800">0%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-3">
                                    <div id="bar-o" class="bg-blue-500 h-3 rounded-full transition-all duration-1000" style="width: 0%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between items-center mb-1">
                                    <span class="text-sm font-medium text-orange-800">Scolaire opportuniste</span>
                                    <span id="score-s-percent" class="text-sm font-bold text-orange-800">0%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-3">
                                    <div id="bar-s" class="bg-orange-500 h-3 rounded-full transition-all duration-1000" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="profile-description" class="bg-gray-50 rounded-lg p-6">
                        <!-- Description du profil sera g√©n√©r√©e ici -->
                    </div>
                </div>

                <!-- Conseils personnalis√©s -->
                <div id="advice-section" class="bg-blue-50 rounded-lg p-6 mb-8">
                    <!-- Conseils seront g√©n√©r√©s ici -->
                </div>

                <!-- Boutons d'action -->
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <button onclick="reviewAnswers()" class="px-6 py-3 bg-gray-100 text-gray-800 rounded-lg font-semibold hover:bg-gray-200 transition-colors duration-200">
                        üëÅÔ∏è Revoir mes r√©ponses
                    </button>
                    <button onclick="downloadPDF()" class="px-6 py-3 bg-gradient-to-r from-green-500 to-blue-600 text-white rounded-lg font-semibold hover:from-green-600 hover:to-blue-700 transition-all duration-200 transform hover:scale-105">
                        üìÑ T√©l√©charger mon rapport (PDF)
                    </button>
                    <button onclick="restartQuiz()" class="px-6 py-3 border-2 border-blue-500 text-blue-600 rounded-lg font-semibold hover:bg-blue-50 transition-colors duration-200">
                        üîÑ Recommencer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Questions et r√©ponses
        const questions = [
            {
                text: "Quand tu utilises une IA, ton but principal est‚Ä¶",
                answers: [
                    { text: "Obtenir une aide ponctuelle sans tricher.", type: "O" },
                    { text: "Trouver des id√©es/structure puis retravailler √† ta fa√ßon.", type: "E" },
                    { text: "Gagner du temps sur un devoir.", type: "S" }
                ]
            },
            {
                text: "Si l'IA te donne une r√©ponse fausse ou floue, tu‚Ä¶",
                answers: [
                    { text: "Reformules ton prompt.", type: "E" },
                    { text: "Compares avec ton cours.", type: "O" },
                    { text: "Copies ce qui te parait correct", type: "S" }
                ]
            },
            {
                text: "Pour toi, utiliser l'IA pour un devoir, c'est surtout‚Ä¶",
                answers: [
                    { text: "Un moyen d'aller plus vite.", type: "S" },
                    { text: "Une fa√ßon d'apprendre autrement.", type: "E" },
                    { text: "Un petit coup de pouce discret.", type: "O" }
                ]
            },
            {
                text: "Quand tu poses une question √† l'IA, tu‚Ä¶",
                answers: [
                    { text: "Fais attention √† ne pas trop l'utiliser.", type: "O" },
                    { text: "Reformules jusqu'√† une r√©ponse claire.", type: "E" },
                    { text: "Prends la premi√®re r√©ponse correcte.", type: "S" }
                ]
            },
            {
                text: "Si un prof encourage l'IA, tu penses que‚Ä¶",
                answers: [
                    { text: "Super, je gagnerai du temps.", type: "S" },
                    { text: "C'est une occasion de mieux comprendre.", type: "E" },
                    { text: "C'est OK si tu sais exactement ce qui est autoris√©.", type: "O" }
                ]
            },
            {
                text: "Quand tu rends un travail aid√© par l'IA, tu‚Ä¶",
                answers: [
                    { text: "Te demandes si tu dois le dire ou pas.", type: "O" },
                    { text: "Ne dis rien et camoufles.", type: "S" },
                    { text: "Indiques comment tu l'as utilis√©e.", type: "E" }
                ]
            },
            {
                text: "Pour comprendre une notion difficile, tu utilises l'IA pour‚Ä¶",
                answers: [
                    { text: "Avoir une explication rapide puis tu relis ton cours pour v√©rifier.", type: "O" },
                    { text: "Obtenir des explications que tu peux approfondir en posant de nombreuses questions .", type: "E" },
                    { text: "Demander une r√©ponse √† copier.", type: "S" }
                ]
            },
            {
                text: "Si un camarade t'envoie une r√©daction faite par IA‚Ä¶",
                answers: [
                    { text: "Tu regardes mais tu r√©diges la tienne.", type: "O" },
                    { text: "Tu cherches √† savoir comment tu pourrais l'am√©liorer", type: "E" },
                    { text: "Tu changes quelques phrases et rends.", type: "S" }
                ]
            },
            {
                text: "L'IA peut aider √† apprendre ?",
                answers: [
                    { text: "Oui, √ßa remplace parfois les cours.", type: "S" },
                    { text: "Oui, si on r√©fl√©chit et reformule.", type: "E" },
                    { text: "Oui, mais attention √† la triche.", type: "O" }
                ]
            },
            {
                text: "Quand tu travailles avec l'IA, tu ressens‚Ä¶",
                answers: [
                    { text: "M√©fiance (peur de mal faire).", type: "O" },
                    { text: "Satisfaction quand √ßa travaille √† ma place.", type: "S" },
                    { text: "Curiosit√© et envie de tester.", type: "E" },
                ]
            },
            {
                text: "Si l'IA est interdite, tu‚Ä¶",
                answers: [
                    { text: "L'utilises discr√®tement.", type: "S" },
                    { text: "Respectes et aimerais en discuter avec l'enseignant.", type: "E" },
                    { text: "Respectes sans r√©fl√©chir.", type: "O" }
                ]
            },
            {
                text: "Quand tu utilises l'IA, tu fais attention √†‚Ä¶",
                answers: [
                    { text: "Ce qui est autoris√©.", type: "O" },
                    { text: "La qualit√© des sources/v√©racit√©.", type: "E" },
                    { text: "Finir vite.", type: "S" }
                ]
            },
            {
                text: "Quelle phrase te ressemble le plus ?",
                answers: [
                    { text: "L'IA est pratique pour aller vite.", type: "S" },
                    { text: "L'IA approfondit mes apprentissages.", type: "E" },
                    { text: "L'IA m'aide mais j'ai un peu l'impression de tricher", type: "O" }
                ]
            },
            {
                text: "Avant de rendre un texte g√©n√©r√© par IA, tu‚Ä¶",
                answers: [
                    { text: "Veux √™tre s√ªr d'avoir bien compris les consignes concernant l'utilisation de l'IA", type: "O" },
                    { text: "V√©rifie la justesse des infomations, reformule tout ce que tu as envie de reformuler", type: "E" },
                    { text: "Changes un peu pour que √ßa se voie moins.", type: "S" }
                ]
            },
            {
                text: "Si l'IA se trompe, c'est parce que‚Ä¶",
                answers: [
                    { text: "Je n'aurais pas d√ª utiliser l'IA.", type: "O" },
                    { text: "Ma question √©tait mal formul√©e.", type: "E" },
                    { text: "Ce n'est pas grave.", type: "S" }
                ]
            },
            {
                text: "Le r√¥le de l'IA √† l'√©cole devrait √™tre‚Ä¶",
                answers: [
                    { text: "Un assistant pour gagner du temps.", type: "S" },
                    { text: "Un outil d'apprentissage critique.", type: "E" },
                    { text: "Un soutien avec r√®gles claires.", type: "O" }
                ]
            },
            {
                text: "Tu fais confiance √† l'IA quand elle explique ?",
                answers: [
                    { text: "Oui, sauf si c'est contraire √† ce qu'√† dit l'enseignant.", type: "O" },
                    { text: "Je v√©rifie toujours ailleurs.", type: "E" },
                    { text: "Oui, je ne perd pas de temps √† v√©rifier.", type: "S" }
                ]
            },
            {
                text: "Quand un prof parle d'IA, tu‚Ä¶",
                answers: [
                    { text: "√âcoutes sans avis.", type: "O" },
                    { text: "Participes et poses des questions.", type: "E" },
                    { text: "T'ennuies, c'est √©vident.", type: "S" }
                ]
            },
            {
                text: "Si tu pouvais cr√©er un outil IA, il‚Ä¶",
                answers: [
                    { text: "Donnerait des r√©ponses fiables vite.", type: "S" },
                    { text: "Aiderait √† apprendre par explications adapt√©es.", type: "E" },
                    { text: "Serait autoris√© partout.", type: "O" }
                ]
            },
            {
                text: "Apprendre √† bien utiliser l'IA √† l'√©cole, c'est‚Ä¶",
                answers: [
                    { text: "Utile mais pas prioritaire.", type: "O" },
                    { text: "Indispensable pour le futur.", type: "E" },
                    { text: "Utile pour aller √† l'essentiel", type: "S" }
                ]
            }
        ];

        // Variables globales
        let currentQuestionIndex = 0;
        let answers = [];
        let scores = { E: 0, O: 0, S: 0 };
        let lastPercentages = { E: 0, O: 0, S: 0 };
        let lastProfileDetails = { title: '', description: '' };

        const dom = {
            welcomeScreen: document.getElementById('welcome-screen'),
            questionScreen: document.getElementById('question-screen'),
            resultsScreen: document.getElementById('results-screen'),
            questionText: document.getElementById('question-text'),
            currentQuestion: document.getElementById('current-question'),
            progressPercent: document.getElementById('progress-percent'),
            progressBar: document.getElementById('progress-bar'),
            answersContainer: document.getElementById('answers-container'),
            prevBtn: document.getElementById('prev-btn'),
            nextBtn: document.getElementById('next-btn'),
            scoreEPercent: document.getElementById('score-e-percent'),
            scoreOPercent: document.getElementById('score-o-percent'),
            scoreSPercent: document.getElementById('score-s-percent'),
            barE: document.getElementById('bar-e'),
            barO: document.getElementById('bar-o'),
            barS: document.getElementById('bar-s'),
            resultsSummary: document.getElementById('results-summary'),
            profileDescription: document.getElementById('profile-description'),
            adviceSection: document.getElementById('advice-section')
        };

        // D√©marrer le questionnaire
        function startQuiz() {
            dom.welcomeScreen.classList.add('hidden');
            dom.questionScreen.classList.remove('hidden');
            showQuestion();
        }

        // Afficher une question
        function showQuestion() {
            const question = questions[currentQuestionIndex];
            dom.questionText.textContent = question.text;
            dom.currentQuestion.textContent = currentQuestionIndex + 1;
            const progressRatio = (currentQuestionIndex + 1) / questions.length;
            dom.progressPercent.textContent = Math.round(progressRatio * 100);
            dom.progressBar.style.width = `${progressRatio * 100}%`;

            const container = dom.answersContainer;
            container.innerHTML = '';

            const fragment = document.createDocumentFragment();

            question.answers.forEach((answer, index) => {
                const wrapper = document.createElement('div');
                const label = document.createElement('label');
                label.className = 'flex items-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 hover:bg-blue-50 transition-all duration-200';

                const input = document.createElement('input');
                input.type = 'radio';
                input.name = 'answer';
                input.value = String(index);
                input.className = 'mr-3 text-blue-600';
                input.addEventListener('change', updateNextButton);

                const textSpan = document.createElement('span');
                textSpan.className = 'text-gray-700';
                textSpan.textContent = answer.text;

                label.appendChild(input);
                label.appendChild(textSpan);
                wrapper.appendChild(label);
                fragment.appendChild(wrapper);
            });

            container.appendChild(fragment);

            // Restaurer la r√©ponse pr√©c√©dente si elle existe
            if (answers[currentQuestionIndex] !== undefined) {
                const radio = container.querySelector(`input[name="answer"][value="${answers[currentQuestionIndex]}"]`);
                if (radio) radio.checked = true;
            }

            // Mettre √† jour les boutons
            dom.prevBtn.disabled = currentQuestionIndex === 0;
            updateNextButton();
        }

        // Mettre √† jour le bouton suivant
        function updateNextButton() {
            const selected = dom.answersContainer.querySelector('input[name="answer"]:checked');
            dom.nextBtn.disabled = !selected;
        }

        // Question suivante
        function nextQuestion() {
            const selected = dom.answersContainer.querySelector('input[name="answer"]:checked');
            if (!selected) return;

            answers[currentQuestionIndex] = parseInt(selected.value, 10);

            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
            } else {
                calculateResults();
                showResults();
            }
        }

        // Question pr√©c√©dente
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
            }
        }

        // Calculer les r√©sultats
        function calculateResults() {
            scores = { E: 0, O: 0, S: 0 };

            answers.forEach((answerIndex, questionIndex) => {
                if (typeof answerIndex !== 'number') {
                    return;
                }

                const selectedAnswer = questions[questionIndex].answers[answerIndex];
                if (!selectedAnswer) {
                    return;
                }

                const answerType = selectedAnswer.type;
                if (scores[answerType] !== undefined) {
                    scores[answerType]++;
                }
            });
        }

        // Afficher les r√©sultats
        function showResults() {
            dom.questionScreen.classList.add('hidden');
            dom.resultsScreen.classList.remove('hidden');

            const totalNonNeutral = scores.E + scores.O + scores.S;

            if (totalNonNeutral === 0) {
                lastPercentages = { E: 0, O: 0, S: 0 };
                dom.scoreEPercent.textContent = '0%';
                dom.scoreOPercent.textContent = '0%';
                dom.scoreSPercent.textContent = '0%';
                dom.barE.style.width = '0%';
                dom.barO.style.width = '0%';
                dom.barS.style.width = '0%';
                dom.resultsSummary.textContent = 'E = 0% | O = 0% | S = 0%';
                showIndeterminateProfile();
                return;
            }

            const percentages = {
                E: Math.round((scores.E / totalNonNeutral) * 100),
                O: Math.round((scores.O / totalNonNeutral) * 100),
                S: Math.round((scores.S / totalNonNeutral) * 100)
            };

            lastPercentages = percentages;

            // Afficher les pourcentages et barres
            setTimeout(() => {
                dom.scoreEPercent.textContent = `${percentages.E}%`;
                dom.scoreOPercent.textContent = `${percentages.O}%`;
                dom.scoreSPercent.textContent = `${percentages.S}%`;

                dom.barE.style.width = `${percentages.E}%`;
                dom.barO.style.width = `${percentages.O}%`;
                dom.barS.style.width = `${percentages.S}%`;

                // Mettre √† jour le r√©sum√© des r√©sultats
                dom.resultsSummary.textContent = `E = ${percentages.E}% | O = ${percentages.O}% | S = ${percentages.S}%`;
            }, 500);

            // D√©terminer le profil selon les nouvelles r√®gles
            determineProfile(percentages);
        }

        // D√©terminer le profil selon les crit√®res sp√©cifi√©s
        function determineProfile(percentages) {
            const maxScore = Math.max(percentages.E, percentages.O, percentages.S);
            const dominantTypes = [];
            
            // Identifier les types dominants
            if (percentages.E === maxScore) dominantTypes.push('E');
            if (percentages.O === maxScore) dominantTypes.push('O');
            if (percentages.S === maxScore) dominantTypes.push('S');

            // V√©rifier si une posture est ‚â• 40% et strictement dominante
            let isDominant = false;
            let dominantType = null;

            if (dominantTypes.length === 1 && maxScore >= 40) {
                // V√©rifier que l'√©cart avec les autres est > 10 points
                const otherScores = Object.values(percentages).filter(score => score !== maxScore);
                const maxOtherScore = Math.max(...otherScores);
                
                if (maxScore - maxOtherScore >= 10) {
                    isDominant = true;
                    dominantType = dominantTypes[0];
                }
            }

            if (isDominant) {
                showDominantProfile(dominantType, percentages);
            } else {
                showMixedProfile(percentages);
            }
        }

        // Profil dominant
        function showDominantProfile(profile, percentages) {
            const profiles = {
                E: {
                    title: "Engag√© r√©flexif",
                    description: "Tu utilises l'IA pour apprendre : reformulation, v√©rification, curiosit√©. Continue √† demander pourquoi et √† comparer aux cours.",
                    color: "green-800"
                },
                O: {
                    title: "Occasionnel l√©galiste",
                    description: "Tu es prudent et respectes les r√®gles. Pour progresser : ose reformuler, demande des explications pas √† pas, compare plusieurs sources, explicite comment tu utilises l'IA.",
                    color: "blue-800"
                },
                S: {
                    title: "Scolaire opportuniste",
                    description: "Tu utilises l'IA surtout pour aller vite. Pour progresser : relis et r√©√©cris avec tes mots, demande √† l'IA d'expliquer comment elle a construit sa r√©ponse, v√©rifie avec le cours, cr√©e ta version am√©lior√©e.",
                    color: "orange-800"
                }
            };

            const profileData = profiles[profile];
            dom.profileDescription.innerHTML = `
                <h3 class="text-lg font-semibold text-${profileData.color} mb-3">Ta posture actuelle : ${profileData.title}</h3>
                <p class="text-gray-800">${profileData.description}</p>
            `;

            lastProfileDetails = {
                title: `Ta posture actuelle : ${profileData.title}`,
                description: profileData.description
            };

            showAdviceSection();
        }

        // Profil mixte
        function showMixedProfile(percentages) {
            dom.profileDescription.innerHTML = `
                <h3 class="text-lg font-semibold text-purple-800 mb-3">Profil mixte</h3>
                <p class="text-gray-800">Tu combines plusieurs postures. Choisis une habitude "r√©flexive" √† tester cette semaine (reformuler, v√©rifier les sources, expliquer pourquoi).</p>
            `;

            lastProfileDetails = {
                title: 'Profil mixte',
                description: 'Tu combines plusieurs postures. Choisis une habitude "r√©flexive" √† tester cette semaine (reformuler, v√©rifier les sources, expliquer pourquoi).'
            };

            showAdviceSection();
        }

        // Conseils vers l'engag√© r√©flexif (toujours afficher)
        function showAdviceSection() {
            dom.adviceSection.innerHTML = `
                <h3 class="text-lg font-semibold text-blue-800 mb-4">Conseils "vers l'engag√© r√©flexif"</h3>
                <div class="space-y-3">
                    <div class="flex items-start">
                        <span class="bg-blue-100 text-blue-800 rounded-full w-6 h-6 flex items-center justify-center text-sm font-semibold mr-3 mt-0.5">1</span>
                        <p class="text-blue-800">Reformule tes questions et r√©ponses.</p>
                    </div>
                    <div class="flex items-start">
                        <span class="bg-blue-100 text-blue-800 rounded-full w-6 h-6 flex items-center justify-center text-sm font-semibold mr-3 mt-0.5">2</span>
                        <p class="text-blue-800">V√©rifie avec tes notes ou d'autres sources.</p>
                    </div>
                    <div class="flex items-start">
                        <span class="bg-blue-100 text-blue-800 rounded-full w-6 h-6 flex items-center justify-center text-sm font-semibold mr-3 mt-0.5">3</span>
                        <p class="text-blue-800">Explique le raisonnement demand√© (pas seulement la r√©ponse).</p>
                    </div>
                    <div class="flex items-start">
                        <span class="bg-blue-100 text-blue-800 rounded-full w-6 h-6 flex items-center justify-center text-sm font-semibold mr-3 mt-0.5">4</span>
                        <p class="text-blue-800">Personnalise le texte (exemples, vocabulaire √† toi).</p>
                    </div>
                    <div class="flex items-start">
                        <span class="bg-blue-100 text-blue-800 rounded-full w-6 h-6 flex items-center justify-center text-sm font-semibold mr-3 mt-0.5">5</span>
                        <p class="text-blue-800">Rends transparent l'usage de l'IA (dire comment et pourquoi).</p>
                    </div>
                </div>
            `;
        }

        // Profil ind√©termin√©
        function showIndeterminateProfile() {
            dom.profileDescription.innerHTML = `
                <h3 class="text-lg font-semibold text-gray-800 mb-3">Profil ind√©termin√©</h3>
                <p class="text-gray-800">Tes r√©ponses ne permettent pas de d√©finir une posture claire face √† l'IA. Tu es peut-√™tre encore en phase de d√©couverte.</p>
            `;

            dom.adviceSection.innerHTML = `
                <h3 class="text-lg font-semibold text-blue-800 mb-3">Conseils pour commencer</h3>
                <p class="text-blue-800">Prends le temps d'exp√©rimenter avec l'IA dans un cadre scolaire. Commence par de petites questions et observe comment elle peut t'aider √† apprendre.</p>
            `;

            lastProfileDetails = {
                title: 'Profil ind√©termin√©',
                description: 'Tes r√©ponses ne permettent pas de d√©finir une posture claire face √† l\'IA. Tu es peut-√™tre encore en phase de d√©couverte.'
            };
        }

        // T√©l√©charger le PDF
        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Titre principal
            doc.setFontSize(18);
            doc.text('Ton rapport personnel ‚Äî Mon rapport √† l\'IA', 20, 25);
            
            // Bloc R√©sultats
            doc.setFontSize(14);
            doc.text('R√©sultats :', 20, 45);
            
            const totalNonNeutral = scores.E + scores.O + scores.S;
            if (totalNonNeutral > 0) {
                doc.setFontSize(12);
                doc.text(`E = ${lastPercentages.E}% | O = ${lastPercentages.O}% | S = ${lastPercentages.S}%`, 20, 60);

                // D√©tails des pourcentages
                doc.text(`Engag√© r√©flexif (E) : ${lastPercentages.E}%`, 30, 75);
                doc.text(`Occasionnel l√©galiste (O) : ${lastPercentages.O}%`, 30, 85);
                doc.text(`Scolaire opportuniste (S) : ${lastPercentages.S}%`, 30, 95);
            } else {
                doc.setFontSize(12);
                doc.text('Aucun r√©sultat disponible. Termine le questionnaire pour g√©n√©rer ton rapport.', 20, 60);
            }

            // Interpr√©tation du profil
            const profileTextParts = [lastProfileDetails.title, lastProfileDetails.description].filter(Boolean);
            const profileText = profileTextParts.join(' ‚Äî ');
            
            doc.setFontSize(14);
            doc.text('Interpr√©tation :', 20, 115);
            doc.setFontSize(10);
            const splitProfile = doc.splitTextToSize(profileText, 170);
            doc.text(splitProfile, 20, 125);
            
            // Conseils vers l'engag√© r√©flexif
            doc.setFontSize(14);
            doc.text('Conseils "vers l\'engag√© r√©flexif" :', 20, 160);
            doc.setFontSize(10);
            
            const adviceList = [
                '1. Reformule tes questions et r√©ponses.',
                '2. V√©rifie avec tes notes ou d\'autres sources.',
                '3. Explique le raisonnement demand√© (pas seulement la r√©ponse).',
                '4. Personnalise le texte (exemples, vocabulaire √† toi).',
                '5. Rends transparent l\'usage de l\'IA (dire comment et pourquoi).'
            ];
            
            let yPosition = 170;
            adviceList.forEach(advice => {
                doc.text(advice, 20, yPosition);
                yPosition += 10;
            });
            
            // Note de confidentialit√©
            doc.setFontSize(8);
            doc.text('Ce rapport est personnel et confidentiel. Aucune donn√©e nominative n\'est collect√©e.', 20, 250);
            
            doc.save('mon-rapport-ia-ecole.pdf');
        }

        // Revoir les r√©ponses
        function reviewAnswers() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50';

            const dialog = document.createElement('div');
            dialog.className = 'bg-white rounded-xl shadow-lg max-w-4xl w-full max-h-full overflow-y-auto p-6';

            const header = document.createElement('div');
            header.className = 'flex justify-between items-center mb-6';

            const title = document.createElement('h2');
            title.className = 'text-2xl font-bold text-gray-800';
            title.textContent = 'R√©vision de tes r√©ponses';

            const closeIconButton = document.createElement('button');
            closeIconButton.type = 'button';
            closeIconButton.className = 'text-gray-500 hover:text-gray-700 text-2xl';
            closeIconButton.setAttribute('aria-label', 'Fermer');
            closeIconButton.innerHTML = '&times;';
            closeIconButton.addEventListener('click', closeReviewModal);

            header.appendChild(title);
            header.appendChild(closeIconButton);

            const contentWrapper = document.createElement('div');
            contentWrapper.className = 'space-y-4';

            questions.forEach((question, index) => {
                const userAnswerIndex = answers[index];
                const userAnswer = typeof userAnswerIndex === 'number' ? question.answers[userAnswerIndex] : undefined;

                const questionBlock = document.createElement('div');
                questionBlock.className = 'border border-gray-200 rounded-lg p-4';

                const questionTitle = document.createElement('h4');
                questionTitle.className = 'font-semibold text-gray-800 mb-2';
                questionTitle.textContent = `Question ${index + 1}`;

                const questionText = document.createElement('p');
                questionText.className = 'text-gray-600 mb-3';
                questionText.textContent = question.text;

                const answerContainer = document.createElement('div');

                if (userAnswer) {
                    let typeColor = 'gray';
                    let typeName = 'Neutre';

                    if (userAnswer.type === 'E') {
                        typeColor = 'green';
                        typeName = 'Engag√© r√©flexif';
                    } else if (userAnswer.type === 'O') {
                        typeColor = 'blue';
                        typeName = 'Occasionnel l√©galiste';
                    } else if (userAnswer.type === 'S') {
                        typeColor = 'orange';
                        typeName = 'Scolaire opportuniste';
                    }

                    answerContainer.className = `bg-${typeColor}-50 border border-${typeColor}-200 rounded p-3`;

                    const answerLabel = document.createElement('p');
                    answerLabel.className = `text-${typeColor}-800 font-medium`;
                    answerLabel.textContent = 'Ta r√©ponse :';

                    const answerText = document.createElement('p');
                    answerText.className = `text-${typeColor}-800`;
                    answerText.textContent = userAnswer.text;

                    const badge = document.createElement('span');
                    badge.className = `inline-block mt-2 px-2 py-1 bg-${typeColor}-100 text-${typeColor}-800 text-xs rounded-full`;
                    badge.textContent = typeName;

                    answerContainer.appendChild(answerLabel);
                    answerContainer.appendChild(answerText);
                    answerContainer.appendChild(badge);
                } else {
                    answerContainer.className = 'bg-gray-50 border border-gray-200 rounded p-3';

                    const noAnswer = document.createElement('p');
                    noAnswer.className = 'text-gray-700';
                    noAnswer.textContent = 'Tu n\'as pas r√©pondu √† cette question.';

                    answerContainer.appendChild(noAnswer);
                }

                questionBlock.appendChild(questionTitle);
                questionBlock.appendChild(questionText);
                questionBlock.appendChild(answerContainer);

                contentWrapper.appendChild(questionBlock);
            });

            const footer = document.createElement('div');
            footer.className = 'mt-6 text-center';

            const closeButton = document.createElement('button');
            closeButton.type = 'button';
            closeButton.className = 'px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors';
            closeButton.textContent = 'Fermer';
            closeButton.addEventListener('click', closeReviewModal);

            footer.appendChild(closeButton);

            dialog.appendChild(header);
            dialog.appendChild(contentWrapper);
            dialog.appendChild(footer);

            modal.appendChild(dialog);

            document.body.appendChild(modal);
        }

        // Fermer la modal de r√©vision
        function closeReviewModal() {
            const modal = document.querySelector('.fixed.inset-0');
            if (modal) {
                document.body.removeChild(modal);
            }
        }

        // Recommencer
        function restartQuiz() {
            currentQuestionIndex = 0;
            answers = [];
            scores = { E: 0, O: 0, S: 0 };
            lastPercentages = { E: 0, O: 0, S: 0 };
            lastProfileDetails = { title: '', description: '' };

            dom.resultsScreen.classList.add('hidden');
            dom.questionScreen.classList.add('hidden');
            dom.welcomeScreen.classList.remove('hidden');
        }
    </script>
</body>
</html>

